<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>Why We Can't Have Nice Things</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta name="author" content="Jonathan Pearlin" />
        <meta name="keywords" content="" />
        <meta name="generator" content="JBake" />

        <!-- Le styles -->
        <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
        <link href="/blog/css/asciidoctor.css" rel="stylesheet">
        <link href="/blog/css/base.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
              <script src="/blog/js/html5shiv.js"></script>
        <![endif]-->

        <!-- Fav and touch icons -->
        <!--
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png" />
        -->
        <link rel="shortcut icon" href="/blog/favicon.ico" />
    </head>
    <body>
        <div id="wrap">
            <!-- Fixed navbar -->
            <div class="navbar navbar-default navbar-fixed-top" role="navigation">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/blog/index.html">Jonathan Pearlin's Blog</a>
                    </div>
                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="/blog/about.html">About</a></li>
                            <li class="dropdown">
                                <a data-toggle="dropdown" href="#">Tags<b class="caret"></b></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="/blog/tags/grails.html">Grails</a></li>
                                    <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                                    <li><a href="/blog/tags/java.html">Java</a></li>
                                    <li><a href="/blog/tags/maven.html">Maven</a></li>
                                    <li><a href="/blog/tags/spring.html">Spring</a></li>
                                </ul>
                            </li>
                            <li><a href="/blog/feed.xml">Feed</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="https://github.com/jdpgrailsdev" target="_blank"><i class="fa fa-github"></i></a></li>
                            <li><a href="http://www.linkedin.com/pub/jonathan-pearlin/4/946/9a0" style="text-decoration:none;" target="_blank"><i class="fa fa-linkedin-square"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="page-header">
                    <h1>Why We Can't Have Nice Things</h1>
                    <h4>A blog about technical challenges and how to over come them through powers of deduction.</h4>
                </div>
                   <a href="/blog/2012/12/08/relocation.html"><h1>Relocation</h1></a>
                   <p>08 December 2012</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/blog.html">blog</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2012/12/08/relocation.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2012/12/08/relocation.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://melix.github.io/blog/2012/12/08/relocation.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><h2>Relocation</h2><p>I have decided to relocate my blog from <a href="http://jonathan-whywecanthavenicethings.blogspot.com">Blog Spot</a> to <a href="http://jdpgrailsdev.github.io/blog">GitHub</a>. I have not actively posted anything in a while, but I am going to start<br/>up again and felt that hosting it on Github was a better choice. I will leave the old blog up with a pointer over to the new blog.</p></p>
                <p><a href="/blog/2012/12/08/relocation.html#disqus_thread">Comments</a></p>
                   <a href="/blog/2011/11/19/spring_data_mongodb_exceptions.html"><h1>Where's My Exceptions, Spring Data MongoDB?</h1></a>
                   <p>19 November 2011</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/java.html">java</a>
        
                <a href="/blog/tags/mongodb.html"> mongodb</a>
        
                <a href="/blog/tags/spring-data-mongodb.html"> spring-data-mongodb</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2011/11/19/spring_data_mongodb_exceptions.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2011/11/19/spring_data_mongodb_exceptions.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://melix.github.io/blog/2011/11/19/spring_data_mongodb_exceptions.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><h1>Abstraction For the Win!</h1><p>To be fair, the Spring Data MongoDB project is currently only at Milestone releases (as of writing, they are up to M5). Unlike most open source projects, they do have fairly good reference documentation. Recently, we decided to add some unique contraints to a document by adding a compound index. The Spring Data MongoDB project provides a couple mechanisms to be able to do this:</p>
<ol>
  <li>Use the MongoTemplate class's ensureIndex method to programmatically create an index at runtime.</li>
  <li>Use the CompoundIndexes and CompoundIndex annotations to declare the indexes on the document model class.</li>
  <li>Manually create the index(es) against the database using the MongoDB command line.</li>
</ol><p>For a variety of reasons, I decided to go with option #2. Using the annotations is pretty straight forward:</p>
<pre><code>package test;

import org.springframework.data.mongodb.core.index.CompoundIndex;
import org.springframework.data.mongodb.core.index.CompoundIndexes;
import org.springframework.data.mongodb.core.mapping.Document;

@Document(collection=&quot;people&quot;)
@CompoundIndexes(value={
    @CompoundIndex(name=&quot;people_first_name_address_idx&quot;, def=&quot;{&#39;firstName&#39;:1, &#39;address&#39;:1}&quot;, unique=true),
    @CompoundIndex(name=&quot;people_last_name_address_idx&quot;, def=&quot;{&#39;lastName&#39;:1, &#39;address&#39;:1}&quot;, unique=true)
})
public class Person {

    private String address;
    private String firstName;
    private String lastName;

    ...
}
</code></pre><p>The example above declares two MongoDB compound indexes. In the first one, it is creating an index on the firstName and address properties of the document. The ":1" tells the index to sort that column in ascending order for the index (see the org.springframework.data.mongodb.core.query.Order class's Javadoc for more details on sort orders). The "unique=true" property tells MongoDB to reject any inserts/saves that violate this contraint (think a unique contraint in the SQL world). There are other properties on the CompoundIndex annotation, so refer to the Spring Data MongoDB Javadocs for more information. When the application starts up, the Spring Data MongoDB library listens for the application start event via Spring and will create the indexes automatically (if they don't already exist). This is a benefit over options 1 and 3 above that require manual intervention.</p><h2>So Why Didn't It Work?</h2><p>According to the paragraph above, it is pretty easy to set up indexes using Spring Data MongoDB. You annotate your classes, start your application and run some tests to make sure the unique constraint is being honored, right? That's what I thought too. I started out by annotating my document objects and re-building my application. Before installing and starting my application in Tomcat, I decided to completely drop my database from MongoDB to ensure that everything was being created properly. Once I was sure everything was clean, I installed my application and started Tomcat, causing Spring Data MongoDB to create the database, the collections and the indexes when the web application started. I verified this by running the following command in MongoDB to see the indexes existed:</p>
<pre><code>MongoDB shell version: 1.8.2
connecting to: test
&gt; db.people.getIndexes()
[
        {
                &quot;name&quot; : &quot;_id_&quot;,
                &quot;ns&quot; : &quot;test.people&quot;,
                &quot;key&quot; : {
                     &quot;_id&quot; : 1
                },
                &quot;v&quot; : 0
        },
        {
                &quot;name&quot; : &quot;people_first_name_address_idx&quot;,
                &quot;ns&quot; : &quot;test.people&quot;,
          &quot;dropDups&quot; : false,
          &quot;sparse&quot; : false,
          &quot;unique&quot; : true,
          &quot;key&quot; : {
                        &quot;firstName&quot; : 1,
                        &quot;address&quot; : 1
                },
                &quot;v&quot; : 0
        },
        {
                &quot;name&quot; : &quot;people_last_name_address_idx&quot;,
              &quot;ns&quot; : &quot;test.people&quot;,
                &quot;dropDups&quot; : false,
          &quot;sparse&quot; : false,
          &quot;unique&quot; : true,
                &quot;key&quot; : {
                    &quot;lastName&quot; : 1,
                    &quot;address&quot; : 1
                },
                &quot;v&quot; : 0
        }
]
&gt; 
</code></pre><p>This allowed me to verify that Spring Data MongoDB actually did create the indexes at startup. So far, so good. My next step was to insert some data to the collection via my application. This worked and I was able to verify the document in MongoDB by using the .find({}) operation on the collection from the command line. The next step was to attempt to insert the exact same document, which should fail due to the unique constraints. To my surprise, it did not fail and I did not receive any exceptions from the MongoTemplate class (which executed the insert). Just to make sure I wasn't crazy, I took the JSON and inserted it directly to the collection using the .save({...}) operation on the collection via the Mongo command line. It did exactly what I expected it to do:</p>
<pre><code>E11000 duplicate key error index: test-people.$people_first_name_address_idx  dup key: { : &quot;John&quot;, : &quot;123 Fake Street&quot; }
</code></pre><p>This meant that index was working. So what was Spring Data MongoDB's problem? What was happening to the error? After some Google-foo, I stumbled across this JIRA issue: <a href="https://jira.springsource.org/browse/DATAMONGO-134">https://jira.springsource.org/browse/DATAMONGO-134</a>. Hidden in there was the answer to my problem. By default, the MongoTemplate class uses the default WriteConcern from the MongoDB Java Driver library. The default WriteConcern as it turns out does NOT raise exceptions for server errors, only network errors. This means that you will only receive an exception if you lose connection to the database or try to connect to an invalid address/port and will not receive an exception for any errors generated by MongoDB. Lame, but easy to fix. The WriteConcern class comes with some static constants that define the following write concern options:</p>
<pre><code>/** No exceptions are raised, even for network issues */
public final static WriteConcern NONE = new WriteConcern(-1);

/** Exceptions are raised for network issues, but not server errors */
public final static WriteConcern NORMAL = new WriteConcern(0);

/** Exceptions are raised for network issues, and server errors; waits on a server for the write operation */
public final static WriteConcern SAFE = new WriteConcern(1);

/** Exceptions are raised for network issues, and server errors and the write operation waits for the server to flush the data to disk*/
public final static WriteConcern FSYNC_SAFE = new WriteConcern(true);

/** Exceptions are raised for network issues, and server errors; waits for at least 2 servers for the write operation*/
public final static WriteConcern REPLICAS_SAFE = new WriteConcern(2);
</code></pre><p>So, depending on your needs, you can change the write concern options used by the MongoTemplate class. Since I was using Spring to instantiate the MongoTemplate class, this required a couple of changes to my applicationContext.xml file:</p>
<pre><code>&lt;beans 
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;      
    xmlns:mongo=&quot;http://www.springframework.org/schema/data/mongo&quot; 
    xmlns:util=&quot;http://www.springframework.org/schema/util&quot;  
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; 
    xmlns=&quot;http://www.springframework.org/schema/beans&quot; 
    xsi:schemalocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
    http://www.springframework.org/schema/data/mongo http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd&quot;&gt;

    ...

    &lt;mongo:db-factory dbname=&quot;${mongodb.database}&quot; host=&quot;${mongodb.host}&quot; id=&quot;databaseFactory&quot; password=&quot;${mongodb.password}&quot; port=&quot;${mongodb.port}&quot; username=&quot;${mongodb.username}&quot; /&gt;

    &lt;bean class=&quot;org.springframework.data.mongodb.core.MongoTemplate&quot; id=&quot;mongoTemplate&quot;&gt;
        &lt;constructor-arg name=&quot;mongoDbFactory&quot; ref=&quot;databaseFactory&quot; /&gt;
        &lt;property name=&quot;writeConcern&quot;&gt;
            &lt;util:constant static-field=&quot;com.mongodb.WriteConcern.SAFE&quot; &gt;&lt;/util:constant&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
    ...  
&lt;/beans&gt;
</code></pre><p>After making this change and restarting the application, I finally go the exception I was expecting to receive from Spring Data MongoDB:</p>
<pre><code>2011-11-18 15:44:32,913 ERROR - Unable to create or update person &#39;{&quot;firstName&quot; : &quot;John&quot;, &quot;lastName&quot; : &quot;Doe&quot;, &quot;address&quot;: &quot;123 Fake Street&quot;}&#39;.
org.springframework.dao.DuplicateKeyException: E11000 duplicate key error index: test.people.$people_first_name_address_idx  dup key: { : &quot;John&quot;, : &quot;123 Fake Street&quot;}; nested exception is com.mongodb.MongoException$DuplicateKey: E11000 duplicate key error index: test.people.$people_first_name_address_idx  dup key: { : &quot;John&quot;, : &quot;123 Fake Street&quot;};
    at org.springframework.data.mongodb.core.MongoExceptionTranslator.translateExceptionIfPossible(MongoExceptionTranslator.java:53)
    at org.springframework.data.mongodb.core.MongoTemplate.potentiallyConvertRuntimeException(MongoTemplate.java:1373)
    at org.springframework.data.mongodb.core.MongoTemplate.execute(MongoTemplate.java:333)
    at org.springframework.data.mongodb.core.MongoTemplate.saveDBObject(MongoTemplate.java:739)
    at org.springframework.data.mongodb.core.MongoTemplate.doSave(MongoTemplate.java:679)
    at org.springframework.data.mongodb.core.MongoTemplate.save(MongoTemplate.java:669)
    at org.springframework.data.mongodb.core.MongoTemplate.save(MongoTemplate.java:665)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at com.sun.jersey.spi.container.JavaMethodInvokerFactory$1.invoke(JavaMethodInvokerFactory.java:60)
    at com.sun.jersey.server.impl.model.method.dispatch.AbstractResourceMethodDispatchProvider$ResponseOutInvoker._dispatch(AbstractResourceMethodDispatchProvider.java:205)
    at com.sun.jersey.server.impl.model.method.dispatch.ResourceJavaMethodDispatcher.dispatch(ResourceJavaMethodDispatcher.java:75)
    at com.sun.jersey.server.impl.uri.rules.HttpMethodRule.accept(HttpMethodRule.java:288)
    at com.sun.jersey.server.impl.uri.rules.ResourceClassRule.accept(ResourceClassRule.java:108)
    at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:147
    at com.sun.jersey.server.impl.uri.rules.RootResourceClassesRule.accept(RootResourceClassesRule.java:84)
    at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:1465)
    at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:1396)
    at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:1345)
    at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:1335)
    at com.sun.jersey.spi.container.servlet.WebComponent.service(WebComponent.java:416)
    at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:537)
    at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:699)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:849)
    at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)
    at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:454)
    at java.lang.Thread.run(Thread.java:680)
Caused by: com.mongodb.MongoException$DuplicateKey: E11000 duplicate key error index: test.people.$people_first_name_address_idx  dup key: { : &quot;John&quot;, : &quot;123 Fake Street&quot;};
    at com.mongodb.CommandResult.getException(CommandResult.java:80)
    at com.mongodb.CommandResult.throwOnError(CommandResult.java:116)
    at com.mongodb.DBTCPConnector._checkWriteError(DBTCPConnector.java:126)
    at com.mongodb.DBTCPConnector.say(DBTCPConnector.java:148)
    at com.mongodb.DBTCPConnector.say(DBTCPConnector.java:132)
    at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:262)
    at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:217)
    at com.mongodb.DBCollection.insert(DBCollection.java:71)
</code></pre><p> at com.mongodb.DBCollection.save(DBCollection.java:633)<br/> at org.springframework.data.mongodb.core.MongoTemplate$13.doInCollection(MongoTemplate.java:745)<br/> at org.springframework.data.mongodb.core.MongoTemplate.execute(MongoTemplate.java:331)<br/> ... 41 more</p><p>So, it is really hard to blame the Spring Data MongoDB guys for this issue, as it is really a configuration option of the underlying MongoDB Java Driver. However, the MongoTemplate class does have a setWriteConcern method for this very reason and it would have saved me some time if the reference documentation had mentioned this and/or had some examples on how to change the setting. I guess that will be in the "release" :).</p></p>
                <p><a href="/blog/2011/11/19/spring_data_mongodb_exceptions.html#disqus_thread">Comments</a></p>
                   <a href="/blog/2011/09/26/trains_planes_auto.html"><h1>Planes, Trains, and Automobiles</h1></a>
                   <p>26 September 2011</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/travel.html">travel</a>
        
                <a href="/blog/tags/united.html"> united</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2011/09/26/trains_planes_auto.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2011/09/26/trains_planes_auto.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://melix.github.io/blog/2011/09/26/trains_planes_auto.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><h1>Fun with Airports</h1>
<table class="tr-caption-container" cellspacing="0" cellpadding="0" style="float: left; margin-right: 1em; text-align: left;">
	<tbody>
		<tr>
			<td style="text-align: center;">
				<p>
					<a style="margin-left: auto; margin-right: auto;" imageanchor="1" href="/blog/img/planes-trains-automobiles.jpg">
						<img width="320" height="198" border="0" src="/blog/img/planes-trains-automobiles.jpg">
					</a>
				</p>
			</td>
		</tr>
		<tr>
			<td class="tr-caption" style="text-align: center;">
				<p>If I had been able to sing "Mess Around" with John Candy,</p>
				<p>maybe my trip wouldn't have been as bad either.</p>
			</td>
		</tr>
	</tbody>
</table><p>At some point, if you fly enough, you go through one of those "trips from hell" thanks to the airline industry. Weather gets in the way of travel or you get delayed just enough that you miss that connection and spend the night sleeping in the airport in Little Rock, Arkansas. Then there are those trips that just highlight the complete breakdown in rational thought and competence. This is the story of my attempt to get from Burlington, VT to Washington-Dulles International Airport. It will make you laugh. It will make you cry. It will make you understand why you should never fly United Airlines. It will also highlight why doing just a little extra to help your customers goes a long way (instead of choosing the tactics United uses to treat its customers like boxes of diapers being shipped from a distribution center to a Walmart -- i.e., it gets there when it gets there).<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/></p><h2>The Storm on the Horizon</h2>
<table class="tr-caption-container" cellspacing="0" cellpadding="0" style="float: right; text-align: center;">
	<tbody>
		<tr>
			<td style="text-align: center;">
				<p>
					<a style="margin-left: auto; margin-right: auto;" imageanchor="1" href="/blog/img/terminal-tom-hanks.jpg">
						<img width="320" height="207" border="0" src="/blog/img/terminal-tom-hanks.jpg">
					</a>
				</p>
			</td>
		</tr>
		<tr>
			<td class="tr-caption" style="text-align: center;">
				<p>In retrospect, it would have made more</p>
				<p>sense to just rent a car and drive the 10 hours.</p>
			</td>
		</tr>
	</tbody>
</table><p>I finished up at work and headed to the airport a little after 5 PM on Friday. My flight was scheduled to leave Burlington, VT at 7:02 PM (Flight 3912). It was a direct flight to Washington-Dulles International Airport (IAD), which was suppose to hand a little after 9 PM. I got off the rental car, made it through security, and sat down at the gate at around 5:40 PM. At around 6:00 PM, the gate agent got on the PA and informed us that the plane had not yet left IAD due to a "maintenance issue" and that we probably wouldn't be leaving any time before 7:45 PM. She said that she could help people rebook their trips if this was going to cause them to miss their connections and would try to get hotel rooms for people who would opt to wait for the flight at 6 AM out of Burlington for IAD the next day. However, as she pointed out, there were no hotel rooms available in Burlington, due to a couple of college class reunions and a car show going on (we learned later that what this really meant was that the one hotel that took United vouchers was full and United won't pay for any other hotel -- or at least that was the message). After a hand-full of people made their way to the gate to get re-booked, the gate attendant came back on the PA at around 6:30 PM to announce that the plane had taken off from IAD and would land in Burlington around 8:00 PM. It would take about 20 minutes to turn the plane around, which would mean we would get into IAD at around 10:00 PM (not bad, since this is only an hour later than originally scheduled, if you overlook the whole "maintenance" issue with the plane that delayed it in the first place). Again, the gate attendant asked if anyone needed to re-book and spent roughly the next hour helping customers (we found out later that she worked for Delta, but had to cover the United gate).</p><h2>Take It For a Test Drive</h2>
<table class="tr-caption-container" cellspacing="0" cellpadding="0" style="float: left; text-align: center;">
	<tbody>
		<tr>
			<td style="text-align: center;">
				<p>
					<a style="margin-left: auto; margin-right: auto;" imageanchor="1" href="/blog/img/airplane7.jpg">
						<img width="320" height="181" border="0" src="/blog/img/airplane7.jpg">
					</a>
				</p>
			</td>
		</tr>
		<tr>
			<td class="tr-caption" style="text-align: center;">
				<p>The funny thing about all of this is that the 2 gate attendants</p>
				<p>and the 4 TSA workers couldn't go home until we took off,</p>
				<p>so they were definitely motivated to get us out of there.</p>
			</td>
		</tr>
	</tbody>
</table><p>At 8:00 PM, the plane from IAD landed and the passengers deplaned. There were about 30 of us left still waiting to get on the flight back to IAD. Just as all of the passengers got off the plane, one of the workers from the tarmac came in and took the PA microphone. He announced that there was another "maintenance" problem with the plane and it would take two hours to test. He would get back to us at that time with an update. In retrospect, this was the point where I should have just gone down stairs, rented a car, and drove the 10 hours from Burlington to my house outside of IAD. Needless to say, this news was met with a lot of complaints and comments. Again, a group of people tried to get re-booked and called around to find their own hotels. Luckily for me, Burlington International Airport has free WiFi, so I kicked back, plugged my laptop in and connected to my SlingBox (just to give you a sense of how long the delay was, I was able to watch two episodes of Family Guy and the first National Treasures movie in that time). Also during this time, one of the TSA workers "hit the wrong button" during a test that sounded an alarm that ordered "all TSA personel to secure all exits" to the terminal "immediately" (they quickly told us that this was an accident. At around 10:00 PM the same ground crew member came in to announce that the "tests went well" and they just needed to take the plane "out for a test drive". Let me stop here and highlight how ridiculous this was. I have never heard of this before. They literally taxied the plane out on to the runway (with no passengers), started the engines up full speed and proceeded to drive around the runway "testing" the aircraft. This went on for about an hour. During this time, I believe that one of the gate attendants ran home to get her dog (or at least take care of her dog), while the other covered for her. At around 11 PM, the plane made its way back to the gate, but ran into another road block. While they were out joyriding in the plane, another plane had landed and pulled up to our gate to deplane. Our plane had to wait on the tarmac for this to unfold. So, at about 11:20, our plane pulled back up to the gate. The ground crew member came back inside an announced that the test drive was a success. They simply had to run on more final test and fill out some paperwork. He would get back to us in 35 minutes. This, obviously, was met with sarcastic comments and groans from the 20 or so of us left in the terminal. At about midnight, we finally lined up to get on the plane.</p><h2>The Point of No Return</h2>
<table class="tr-caption-container" cellspacing="0" cellpadding="0" style="float: right; margin-left: 1em; text-align: right;">
	<tbody>
		<tr>
			<td style="text-align: center;">
				<p>
					<a style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;" imageanchor="1" href="/blog/img/airplane.jpg">
						<img border="0" src="/blog/img/airplane.jpg">
					</a>
				</p>
			</td>
		</tr>
		<tr>
			<td class="tr-caption" style="text-align: center;">
				<p>Our first attempt at landing  kind of went like this...</p>
			</td>
			<td class="tr-caption" style="text-align: center;">
				<p> </p>
			</td>
			<td class="tr-caption" style="text-align: center;">
				<p>
					<br>
				</p>
			</td>
		</tr>
	</tbody>
</table><p>I've never seen a plane board that quickly. There was a good chuckle from the crowd when the gate attendant announced that "premium" customers were welcome to board first. We got on the plane and settled in about 5 or 10 minutes. I got a look at the pilots, who were both no older than 25 years old each (this will be important later). We pushed back from the terminal, taxied out to the runway and then nothing. We sat. And sat. And sat. After about 30 minutes, the pilot came on the intercom and told us that because it was so late, the air traffic control tower had shut down for the evening. He told us that normally this isn't a problem, as our plane got transferred to regional air traffic control. However, because the regional air traffic control was now in charge, we had to wait for all inbound planes to land first before being cleared for take off (this is obviously because they are not local to the air field and therefore can't see what is going on). So we waited. And waited. At a little after 1 AM, we finally took off. It had been delayed by over 5 hours, but we were finally going to get home, even if it was at 3 AM. The flight went smoothly (there were a few turbulence) and at around a little after 3 AM, the pilot notified us that we were starting our decent into the Washington metro area. There were low clouds over the area (we were flying above them) at a couple hundred feet. However, it was not fog: you could see through the clouds in spots and see the lights on the ground. I didn't think anything of it and assumed that we would be on the ground in minutes.</p><h2>Trust Your Instincts, Luke</h2>
<table class="tr-caption-container" cellspacing="0" cellpadding="0" style="float: right; text-align: center;">
	<tbody>
		<tr>
			<td style="text-align: center;">
				<p>
					<a style="margin-left: auto; margin-right: auto;" imageanchor="1" href="/blog/img/dontgo.png">
						<img width="320" height="179" border="0" src="/blog/img/dontgo.png">
					</a>
				</p>
			</td>
		</tr>
		<tr>
			<td class="tr-caption" style="text-align: center;">
				<p>Do you have anything to declare?  Yeah, don't fly United.</p>
			</td>
		</tr>
	</tbody>
</table><p>The plane began its descent. The landing gear came down. We started getting closer to the ground. We started to go through the low lying clouds. Just as I thought that we were going to touch down, the engines went into full throttle, the plane pitched steeply up into the air and banked to the left, back towards Washington, D.C. and the DelMarVa peninsula. After a few minutes, the captain came on and stated that they could not see the runway at the required height, so they aborted the landing. They were going to try landing at a different runway (because that runway would magically have no clouds over it). A few minutes later we made attempt number two, with the same result. As we began circling, the pilot came on to say that he was in a conversation with air traffic control at IAD and regional air traffic control to see what the next step would be. I have no doubt that more experienced pilots would have landed that plane. About ten minutes later, the pilot came back on the intercom to say that we could not land at IAD would be diverted to Allentown, PA. He assured us that United would put us in hotels and help us arrange travel to IAD or some other destination. About 25 minutes later, we landed at the airport in Allentown, PA and again sat on another runway. The pilot told us that they were having trouble finding people at the airport to help us get to the gate. He also told us that "things were changing over the last 30 minutes" and that now the gate agent was trying to arrange "transportation" to IAD for us. We got off the plane and made our way inside to the gate area. After standing around for about 5 minutes, one of the ground crew members from outside came in and got on the microphone. He told us that he had arranged for buses to show up "in 5 or 10 minutes" to take us to IAD, if we were interested. The other option was to stay at the airport. This caught a bunch of people off guard and started asking about a hotel. He said that United would not pay for a hotel, because we were diverted "due to weather". My jaw dropped, as did most of the people standing around the podium. We were diverted "due to weather" because United sent a faulty plane from IAD to Burlington (I wonder how mad the people on that flight would be if they knew the plane they had just gotten off of had 3 hours of maintenance work done on it after they landed). The reason we hit weather was obviously because of United and the issues to the plane. This was a clever trick on their part to get out of having to help their customers. It seems to me, it would have made much more sense to pay $80-90 a person to put the few who wanted to stay in Allentown up for the night and gain a ton of good will. Instead, they pissed off 20+ customers, who will now tell people about this hellish trip and why you shouldn't fly on United. I couldn't listen to this nonsense so I headed down stairs to baggage claim where the bus would supposedly meet us.</p><h2>Get On the Bus!</h2>
<table class="tr-caption-container" cellspacing="0" cellpadding="0" style="float: left; margin-right: 1em; text-align: left;">
	<tbody>
		<tr>
			<td style="text-align: center;">
				<p>
					<a style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;" imageanchor="1" href="/blog/img/partybus.jpg">
						<img width="320" height="240" border="0" src="/blog/img/partybus.jpg">
					</a>
				</p>
			</td>
		</tr>
		<tr>
			<td class="tr-caption" style="text-align: center;">
				<p>Am I in Allentown or Las Vegas?</p>
			</td>
		</tr>
	</tbody>
</table><p>And so we waited. Again. We landed in Allentown at around 3:30 AM. The buses that were suppose to show up in 5-10 minutes finally showed up around 4 AM. I walked out of the baggage claim to find two booze cruise/party buses waiting to take us to IAD (complete with functioning interior LED disco lights and the "Vomit/Destruction will cause you to forfeit your $500 deposit" sign). You couldn't even sleep on this bus, because the seats are on the side, like in the picture to the left. So, in a darkened party bus, we pulled out of the airport in Allentown, PA for the three hour drive through Harrisburg, Gettysburg, Frederick, and finally Leesburg. In the middle of the trip at 5:43 AM, United called my house and sent me this e-mail:<br/><p><br/> <br><br/></p><br/><p class="separator" style="clear: both; text-align: center;"><br/> <a style="margin-left: 1em; margin-right: 1em;" imageanchor="1" href="/blog/img/united.png"><br/> <img width="303" height="320" border="0" src="/blog/img/united.png"><br/> </a><br/></p><br/><p><br/> <br><br/></p><br/>I wish I was funny enough to make up that plot twist. Somehow the flight that didn't get cancelled when it should have been cancelled, got cancelled after I got off it in Allentown, PA. To add insult to injury, United apparently never updated their web site to say that the flight had been diverted, so people were waiting at IAD wondering what happened. I'm sure this was classic CYA by United to make sure that they didn't have to pay anything out to those who stayed in Burlington, VT, as they are not liable if it is cancelled due to weather. So, at 8 AM, we finally pulled into IAD on our party buses. A little over 13 hours from when I was suppose to leave Burlington, I made it home. There was no snow. There was no rain. There was no hurricane or tornado or typhoon. Or earthquake. There was only United Airlines and its terrible customer service. Not a bad way to spend a Friday night, eh?</p></p>
                <p><a href="/blog/2011/09/26/trains_planes_auto.html#disqus_thread">Comments</a></p>
                   <a href="/blog/2011/09/13/spring_integration_jmx.html"><h1>I Don't Need To Read The Manual...Spring Integration and JMX</h1></a>
                   <p>13 September 2011</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/jmx.html">jmx</a>
        
                <a href="/blog/tags/spring-integration.html"> spring-integration</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2011/09/13/spring_integration_jmx.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2011/09/13/spring_integration_jmx.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://melix.github.io/blog/2011/09/13/spring_integration_jmx.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><h1>Enabling JMX Monitoring with Spring Integration</h1><p>The title pretty much says it all. This seems like a pretty simple task, right? I thought that I would just go to the Spring Integration reference documentation, follow the instructions, and boom, you can see all of your Spring Integration components via JMX from your favorite JMX monitoring client. If only it were that easy. The first hurdle I encountered was that the documentation at Spring's site fails to mention how to get the JMX schema included in your integration.xml or where the parsers/handlers live in the Spring library so that it can actually load and parse the integration.xml file. The second is that there appears to be some typos in it (it should be "jmx:mbean-export", not "jmx:mbean-exporter" and the attributes of that tag are also listed incorrectly). Grr (I guess you get what you pay for). So, without further ado, this is how to turn on the MBean Exporter for Spring Integration:</p>
<ol>
  <li><p>Declare the "jmx" namespace in your integration.xml file:</p>
  <pre><code>xmlns:jmx=&quot;http://www.springframework.org/schema/integration/jmx&quot;
</code></pre></li>
  <li><p>Add the "jmx" schema to the "schemaLocation" attribute:</p>
  <pre><code>xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://www.springframework.org/schema/integration/jmx http://www.springframework.org/schema/integration/jmx/spring-integration-jmx-2.0.xsd
http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-2.0.xsd&quot;
</code></pre></li>
  <li><p>Declare the MBean server bean: </p>
  <pre><code>&lt;bean class=&quot;org.springframework.jmx.support.MBeanServerFactoryBean&quot; id=&quot;mbeanServer&quot;&gt;
    &lt;property name=&quot;locateExistingServerIfPossible&quot; value=&quot;true&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre></li>
  <li><p>Declare the Integration MBean Exporter: </p>
  <pre><code>&lt;jmx:mbean-export default-domain=&quot;your.custom.domain&quot; server=&quot;mbeanServer&quot;&gt;&lt;/jmx:mbean-export&gt;
</code></pre></li>
  <li><p>Add the spring-integration-jmx library to your classpath.</p></li>
</ol></p>
                <p><a href="/blog/2011/09/13/spring_integration_jmx.html#disqus_thread">Comments</a></p>

                <hr />

                <p>Older posts are available in the <a href="/blog/archive.html">archive</a>.</p>

            </div>
            <div id="push"></div>
        </div>

        <div id="footer">
              <div class="container">
                <p class="muted credit">&copy; 2014 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v3.0.3</a> | Baked with <a href="http://jbake.org">JBake v2.3.0-SNAPSHOT</a></p>
              </div>
        </div>

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
           <script src="/blog/js/jquery-1.9.1.min.js"></script>
        <script src="/blog/js/bootstrap.min.js"></script>
        <script src="/blog/js/run_prettify.js"></script>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jdpearlin'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <script type="text/javascript">
              window.___gcfg = {lang: 'en'};

              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
        </script>
        <script>
            (function(d, s, id) {
                  var js, fjs = d.getElementsByTagName(s)[0];
                  if (d.getElementById(id)) return;
                  js = d.createElement(s); js.id = id;
                  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                  fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        </script>
        <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47885115-1', 'jdpgrailsdev.github.io');
          ga('send', 'pageview');

        </script>
    </body>
</html>