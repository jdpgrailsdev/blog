<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>The Flowers Are Still Standing</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta name="author" content="Jonathan Pearlin" />
        <meta name="keywords" content="" />
        <meta name="generator" content="JBake" />

        <!-- Le styles -->
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
        <link href="/blog/css/asciidoctor.css" rel="stylesheet">
        <link href="/blog/css/base.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
		<link href='/blog/css/octicons.min.css' rel='stylesheet' type='text/css'>

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
              <script src="/blog/js/html5shiv.js"></script>
        <![endif]-->

        <!-- Fav and touch icons -->
        <!--
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png" />
        -->
        <link rel="shortcut icon" href="/blog/favicon.ico" />
    </head>
    <body>
        <div id="wrap">
            <!-- Fixed navbar -->
            <div class="navbar navbar-default navbar-fixed-top" role="navigation">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/blog/index.html">Jonathan Pearlin's Blog</a>
                    </div>
                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="/blog/about.html">About</a></li>
                            <li><a href="/blog/resume.html">Résumé</a></li>
                            <li><a href="/blog/friends.html">Friends</a></li>
                            <li class="dropdown">
                                <a data-toggle="dropdown" href="#">Tags<b class="caret"></b></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="/blog/tags/gradle.html">Gradle</a></li>
                                    <li><a href="/blog/tags/grails.html">Grails</a></li>
                                    <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                                    <li><a href="/blog/tags/java.html">Java</a></li>
                                    <li><a href="/blog/tags/maven.html">Maven</a></li>
                                    <li><a href="/blog/tags/spring.html">Spring</a></li>
                                    <li><a href="/blog/tags/zookeeper.html">ZooKeeper</a></li>
                                </ul>
                            </li>
                            <li><a href="/blog/feed.xml">Feed</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="https://github.com/jdpgrailsdev" target="_blank"><i class="fa fa-github"></i></a></li>
                            <li><a href="http://www.linkedin.com/pub/jonathan-pearlin/4/946/9a0" style="text-decoration:none;" target="_blank"><i class="fa fa-linkedin-square"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
			<div id="activity" class="pull-left">
	            <div class="panel panel-primary">
	                  <!-- Default panel contents -->
	                  <div class="panel-heading"><a target="_blank" href="http://github.com/jdpgrailsdev?tab=activity"><i class="fa fa-github"></i> My Recent GitHub Activity</a></div>
					  <div class="panel-body">
					      <i class='icon-spinner icon-spin icon-large'></i> Loading...
					  </div>
	                  <!-- List group -->
                      <ul class="list-group">
	                  </ul>
	            </div>
			</div>
            <div class="container">
                <div class="page-header">
                    <h1>The Flowers Are Still Standing</h1>
                </div>

                   <a href="/blog/2014/04/08/spring_boot_gradle_newrelic.html"><h1>Using the New Relic agent with Spring-Boot and Gradle</h1></a>
                   <p>08 April 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/spring.html">spring</a>
        
                <a href="/blog/tags/gradle.html">gradle</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2014/04/08/spring_boot_gradle_newrelic.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2014/04/08/spring_boot_gradle_newrelic.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog/2014/04/08/spring_boot_gradle_newrelic.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>I wanted to play around with <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> the other day and found it pretty easy to get up and running using their <a href="http://gradle.org">Gradle</a> plugin.  After only a few minutes, I had a sample Spring-based web application running as a stand-alone process.  Next, I thought I would add in <a href="http://newrelic.com">New Relic</a> support so I could see some performance stats.  Normally, you would install the <a href="http://newrelic.com">New Relic</a> agent in your application container or add a <code>javaagent</code> JVM option pointing at the <a href="http://newrelic.com">New Relic</a> agent to enable metrics gathering.  In my first attempt, I added the <code>javaagent</code> JVM option pointing at the <a href="http://newrelic.com">New Relic</a> agent to the <code>DEFAULT_JVM_OPTS</code> variable in my <code>gradlew</code> script and restarted the application.  It failed with a weird error about not being able to find some of the classes provided by the <a href="http://newrelic.com">New Relic</a> agent after claiming that it started the agent and found the YAML configuration file.  It seemed like there was obviously some issue between <a href="http://gradle.org">Gradle</a> and the Java agent.  After a
few quick minutes searching on the internets, I found that the <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> <a href="http://gradle.org">Gradle</a> plugin supports passing an agent to the <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> process.  I made the following change to my
<code>build.gradle</code> file:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>apply plugin: 'spring-boot'

...

springBoot {
    mainClass = 'com.sample.Application'
    agent = file('/opt/newrelic/newrelic.jar')			<i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the path to where ever you downloaded and the <a href="http://newrelic.com">New Relic</a> agent JAR to that should include your customized YAML configuration file.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>I restarted my application using the <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> <a href="http://gradle.org">Gradle</a> task (<code>run</code>) and metrics started flowing!  This is great, but it depends on a hard-coded path to the installed <a href="http://newrelic.com">New Relic</a> agent (yuck).
Because you can do anything with <a href="http://gradle.org">Gradle</a> (slight exaggeration), I figured that with some <a href="http://gradle.org">Gradle</a>-foo, I could include the <a href="http://newrelic.com">New Relic</a> agent as a dependency, download it and point to the
downloaded file for the <code>javaagent</code> JVM option.  After a little playing around, I came up with the following:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>apply plugin: 'groovy'
apply plugin: 'spring-boot'

group = 'com.test'
version = '1.0.0-SNAPSHOT'

description = """Test application"""

sourceCompatibility = 1.7
targetCompatibility = 1.7

buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        maven { url "http://repo.spring.io/snapshot" }
        maven { url "http://repo.spring.io/milestone" }
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.0.1.BUILD-SNAPSHOT")
    }
}

configurations {
    newrelic	// Custom configuration to allow for the copying of the New Relic agent at run time.
}

ext {
    groovyVersion='2.2.1'
    newrelicVersion='3.5.1'
    springBootVersion='1.0.1.RELEASE'
    springVersion='4.0.3.RELEASE'
}

repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {
    newrelic "com.newrelic.agent.java:newrelic-agent:${newrelicVersion}"

    compile("org.codehaus.groovy:groovy-all:${groovyVersion}")
    compile("org.springframework:spring-beans:${springVersion}")
    compile("org.springframework:spring-context:${springVersion}")
    compile("org.springframework.boot:spring-boot-starter-web:${springBootVersion}")

    testCompile("org.springframework.boot:spring-boot-starter-test:${springBootVersion}")
}

task copyAgent(type: Copy) {
    from {
        configurations.newrelic				<i class="conum" data-value="1"></i><b>(1)</b>
    }
    into "$buildDir/lib"
    rename ("newrelic-agent-${newrelicVersion}.jar", 'newrelic.jar')
}

springBoot {
    mainClass = 'com.test.sample.Application'
    agent = file("$buildDir/lib/newrelic.jar")		<i class="conum" data-value="2"></i><b>(2)</b>
}

project.tasks.run.dependsOn([copyAgent])			<i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Per the <code>dependencies</code> block, the only file in the <code>newrelic</code> configuration is the agent JAR itself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Tell <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> to use the the downloaded, copied <a href="http://newrelic.com">New Relic</a> agent JAR instead of the previously hard-coded value.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Make the <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> <code>run</code> task depend on the copy task to ensure that the agent is copied before we attempt to launch the application.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, the last thing that I did was set up a symbolic link from my project&#8217;s directory to where my <a href="http://newrelic.com">New Relic</a> YAML file resides.  The <a href="http://newrelic.com">New Relic</a> agent will
automatically look for the <code>newrelic.yml</code> file in the same location as the agent JAR or in the current working directory.  With this last piece in place, all
hard-coded paths are now removed from the equation.</p>
</div>
</div>
</div></p>
                <p><a href="/blog/2014/04/08/spring_boot_gradle_newrelic.html#disqus_thread">Comments</a></p>
                   <a href="/blog/2014/04/03/maven_java8_javadoc.html"><h1>Maven, the JavaDoc plugin and Java 8</h1></a>
                   <p>03 April 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/maven.html">maven</a>
        
                <a href="/blog/tags/java.html">java</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2014/04/03/maven_java8_javadoc.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2014/04/03/maven_java8_javadoc.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog/2014/04/03/maven_java8_javadoc.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>On March 18th, Oracle officially released <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a>.  Eager to start using some of the new features (in a non-beta release), I quickly downloaded and installed the JDK on my laptop.  I switched my
system to use <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a> by default and set upon compiling one of my projects.  To my suprise, the build failed with a bunch of errors that looked like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>[ERROR] Failed to execute goal org.apache.maven.plugins:maven-javadoc-plugin:2.8.1:jar (default) on project ddc-metrics-annotations: MavenReportException: Error while creating archive:
[ERROR] Exit code: 1 - /Projects/libraries/test-library/src/main/java/com/test/Tester.java:30: warning: no @return</code></pre>
</div>
</div>
<div class="paragraph">
<p>It turns out that <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a> includes a much more strict set of rules for its doclint.  According to  <a href="http://blog.joda.org/2014/02/turning-off-doclint-in-jdk-8-javadoc.html">Steven Colebourne</a>, the
<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a> doclint by default enforces the following rules when processing JavaDoc comments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No self-closed HTML tags, such as &lt;br /&gt; or &lt;a id="x" /&gt;</p>
</li>
<li>
<p>No unclosed HTML tags, such as &lt;ul&gt; without matching &lt;/ul&gt;</p>
</li>
<li>
<p>No invalid HTML end tags, such as &lt;/br&gt;</p>
</li>
<li>
<p>No invalid HTML attributes, based on doclint&#8217;s interpretation of W3C HTML 4.01</p>
</li>
<li>
<p>No duplicate HTML id attribute</p>
</li>
<li>
<p>No empty HTML href attribute</p>
</li>
<li>
<p>No incorrectly nested headers, such as class documentation must have &lt;h3&gt;, not &lt;h4&gt;</p>
</li>
<li>
<p>No invalid HTML tags, such as List&lt;String&gt; (where you forgot to escape using &lt;)</p>
</li>
<li>
<p>No broken @link references</p>
</li>
<li>
<p>No broken @param references, they must match the actual parameter name</p>
</li>
<li>
<p>No broken @throws references, the first word must be a class name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is fine if you are starting with a green field project, but if you are like me and have to switch between new and legacy code bases, it may not be possible to correct all of these
issues in order to get <a href="http://maven.apache.org/plugins/maven-javadoc-plugin/">Maven JavaDoc plugin</a> generated using <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a>.  Per <a href="http://blog.joda.org/2014/02/turning-off-doclint-in-jdk-8-javadoc.html">Steven Colebourne&#8217;s blog</a>, the solution is to
include the <code>-Xdoclint:none</code> JVM argument in the configuration of the <a href="http://maven.apache.org/plugins/maven-javadoc-plugin/">Maven JavaDoc plugin</a>:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="prettyprint xml language-xml"><code>...
&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.9.1&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;jar&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;additionalparam&gt;-Xdoclint:none&lt;/additionalparam&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works great when building with <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a>.  However, if you switch back to Java 7 and attempt to build with the <code>-Xdoclint:none</code> JVM argument, the build will fail, as Java 7 does not
recognize that JVM argument.  What can we do to support JavaDoc generation via <a href="http://maven.apache.org/">Maven</a> for both Java 7 and Java 8 on a legacy code base?  Use
<a href="http://maven.apache.org/guides/introduction/introduction-to-profiles.html">Maven profiles</a>!  Instead of modifying the existing <a href="http://maven.apache.org/plugins/maven-javadoc-plugin/">Maven JavaDoc plugin</a> declaration in our <code>pom.xml</code> file, let&#8217;s instead
add a new profile that only activates when we are building with <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a>:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.test&lt;/groupId&gt;
    &lt;artifactId&gt;test&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;

    &lt;build&gt;
        ...
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.9.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

    &lt;profile&gt;
        &lt;id&gt;java8&lt;/id&gt;
        &lt;activation&gt;
            &lt;jdk&gt;1.8&lt;/jdk&gt;								<i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/activation&gt;
        &lt;build&gt;
            &lt;plugins&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                    &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
                    &lt;version&gt;2.9.1&lt;/version&gt;
                    &lt;executions&gt;
                        &lt;execution&gt;
                            &lt;phase&gt;package&lt;/phase&gt;
                            &lt;goals&gt;
                                &lt;goal&gt;jar&lt;/goal&gt;
                            &lt;/goals&gt;
                            &lt;configuration&gt;
                                &lt;additionalparam&gt;-Xdoclint:none&lt;/additionalparam&gt;
                            &lt;/configuration&gt;
                        &lt;/execution&gt;
                    &lt;/executions&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/build&gt;
    &lt;/profile&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Will activate this profile if the JRE that is executing the <a href="http://maven.apache.org/">Maven</a> build is version 1.8 (<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can now safely build our project with either Java 7 or <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a> without having it fail due to either the more strict doclint rules in <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a> or the fact that Java 7 does not recognize
the JVM argument.  I&#8217;m sure that this is not the last of these issues that will come up with regards to changes between previous versions of Java and <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a>.  Luckily, we should be able
to apply the same profile trick for any differences until such a time that all the different code bases that you support are converted to use <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 8</a>.</p>
</div>
</div>
</div></p>
                <p><a href="/blog/2014/04/03/maven_java8_javadoc.html#disqus_thread">Comments</a></p>
                   <a href="/blog/2014/03/24/grails_logback.html"><h1>Grails and Logback</h1></a>
                   <p>24 March 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/grails.html">grails</a>
        
                <a href="/blog/tags/logback.html">logback</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2014/03/24/grails_logback.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2014/03/24/grails_logback.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog/2014/03/24/grails_logback.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The other day, I decided to attempt to switch a <a href="http://grails.org">Grails</a> application from using Log4j (the built-in option) for logging to <a href="http://logback.qos.ch/">Logback</a>.  The core <a href="http://grails.org">Grails</a> development team
maintains a <a href="http://grails.org/plugin/logback">Grails Logback Plugin</a> that appeared to be just what I needed.  I started by modifying my <a href="http://grails.org">Grails</a> application&#8217;s <code>pom.xml</code> file
to reference the <a href="http://grails.org/plugin/logback">Grails Logback Plugin</a>:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="prettyprint xml language-xml"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.grails.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;logback&lt;/artifactId&gt;			<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;version&gt;0.3.1&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that the plugin is a <code>binary</code> plugin, so I did not need to specify the packaging as <code>zip</code>.  If you are not using <a href="http://maven.apache.org/">Maven</a> support with your <a href="http://grails.org">Grails</a> application (or are using a version of <a href="http://grails.org">Grails</a> that did not yet support <a href="http://maven.apache.org/">Maven</a> POM files), you can include
the <a href="http://grails.org/plugin/logback">Grails Logback Plugin</a> in the <code>dependencies</code> block of your <code>grails-app/conf/BuildConfig.groovy</code> and <strong>NOT</strong> in the <code>plugins</code> block.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, I added the following global exclusions to <code>grails-app/conf/BuildConfig.groovy</code>, per the plugin&#8217;s instructions:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/BuildConfig.groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>// inherit Grails' default dependencies
inherits("global") {
    excludes 'grails-plugin-log4j', 'log4j'		<i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If any other dependencies have a runtime dependency on <code>log4j</code>, you will need to remove it from the global excludes.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_follow_the_instructions_they_said">Follow the instructions, they said</h3>
<div class="paragraph">
<p>In my first attempt at getting this working, I next moved on to changing the <code>log4j</code> closure in <code>grails-app/conf/Config.groovy</code> to <code>logback</code>, as the documentation suggests.  Subsequent
digging uncovered that the <a href="http://grails.org/plugin/logback">Grails Logback Plugin</a> only initializes <a href="http://logback.qos.ch/">Logback</a> using the DSL from <code>grails-app/conf/Config.groovy</code> if the application has been deployed as a WAR file
to a container.  What this means in practical terms is that when running a <a href="http://grails.org">Grails</a> application locally using the <code>run-app</code> command, you have no control over the <a href="http://logback.qos.ch/">Logback</a> configuration
via the DSL and thus every log statement gets printed using the default level, which is <code>DEBUG</code> (more on this in a bit&#8230;).</p>
</div>
<div class="paragraph">
<p>Back to my first attempt.  With <code>grails-app/conf/Config.groovy</code> modified, I attempted to run my application, after performing the requisite <code>clean</code> called out by the documentation, but
ran into compile errors related to code that was directly importing and using Log4j.  I fixed these by switching any code that explicitly imported and used the Log4J <code>Logger</code> class to use the SLF4J <code>Logger</code>
instead.  I next ran into some AST transformation errors with classes that had the <a href="http://groovy.codehaus.org">Groovy</a> logging <code>@Log4j</code> annotation present.  I switched these to use the SLF4J logging annotation (<code>@SLF4J</code>).  The
last issue that I encountered in my attempts to get the application to compile and start was related to something that <a href="http://grails.org">Grails</a> automatically puts in <code>grails-app/conf/Config.groovy</code> when generating a
new application (<strong>NOTE</strong>:  the application in question was built using <a href="http://grails.org">Grails</a> version 2.3.5).  By default, when you generate a new application, the following gets added to the configuration:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/Config.groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>environments {
    development {
        grails.logging.jul.usebridge = true
    }
    production {
        grails.logging.jul.usebridge = false
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which enables the use of the SLF4J JUL bridge in the local environment.  If you run the application with <code>grails.logging.jul.usebridge = true</code> <strong>AND</strong> have excluded the <code>grails-plugin-log4j</code> dependency,
you will see the following error upon application start up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint text language-text"><code>| Error 2014-03-11 12:43:41,282 [localhost-startStop-1] ERROR o.c.g.g.w.c.GrailsContextLoader  - Error initializing the application: org.slf4j.bridge.SLF4JBridgeHandler
java.lang.NoClassDefFoundError: org.slf4j.bridge.SLF4JBridgeHandler
    at LogbackGrailsPlugin$_closure2.doCall(LogbackGrailsPlugin.groovy:45) ~[logback-0.3.1.jar:na]
    at grails.spring.BeanBuilder.invokeBeanDefiningClosure(BeanBuilder.java:756) ~[grails-spring-2.3.5.jar:2.3.5]
    at grails.spring.BeanBuilder.beans(BeanBuilder.java:584) ~[grails-spring-2.3.5.jar:2.3.5]
    at grails.spring.BeanBuilder.invokeMethod(BeanBuilder.java:527) ~[grails-spring-2.3.5.jar:2.3.5]
    at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:1.7.0_51]
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_51]
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_51]
    at java.lang.Thread.run(Thread.java:744) [na:1.7.0_51]
Message: org.slf4j.bridge.SLF4JBridgeHandler
    Line | Method
-&gt;&gt;   45 | doCall                    in LogbackGrailsPlugin$_closure2
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
|    756 | invokeBeanDefiningClosure in grails.spring.BeanBuilder
|    584 | beans . . . . . . . . . . in     ''
|    527 | invokeMethod              in     ''
|    262 | run . . . . . . . . . . . in java.util.concurrent.FutureTask
|   1145 | runWorker                 in java.util.concurrent.ThreadPoolExecutor
|    615 | run . . . . . . . . . . . in java.util.concurrent.ThreadPoolExecutor$Worker
^    744 | run                       in java.lang.Thread</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fix for this is to ensure that <code>org.slf4j:jul-to-slf4j:1.7.5</code> is included as a <code>runtime</code> dependency.  If you are using an older version of <a href="http://grails.org">Grails</a>, check the <code>lib</code> directory
of the <a href="http://grails.org">Grails</a> installation to determine the proper version of SLF4J to use.  Also note that if you have any dependencies that require Log4J, you may also need to add that dependency
to the classpath or remove it from the global excludes to get your application to start.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_logback_with_grails_run_app">Using Logback with grails run-app</h3>
<div class="paragraph">
<p>Let&#8217;s get back to the issue of the DSL only being used when the application is deployed as a WAR file.  If you take a look at the plugin descriptor for the <a href="http://grails.org/plugin/logback">Grails Logback Plugin</a>, you will notice this
little snippet:</p>
</div>
<div class="listingblock">
<div class="title">LogbackGrailsPlugin.groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>def doWithSpring = {
    if (application.config?.grails?.logging?.jul?.usebridge) {					<i class="conum" data-value="1"></i><b>(1)</b>
        LogManager.logManager.readConfiguration new ByteArrayInputStream(".level=INFO".bytes)
        SLF4JBridgeHandler.install()
    }

    if (application.warDeployed) {								<i class="conum" data-value="2"></i><b>(2)</b>
        // only initialize here if deployed as a war since doWithWebDescriptor isn't called
        initLogging application
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>grails.logging.jul.usebridge</code> is set to <code>true</code> by default in <code>*Config.groovy</code> when creating a new <a href="http://grails.org">Grails</a> application/plugin in 2.3.x and above.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>warDeployed</code> comes from an entry in <code>application.properties</code> that is added by <a href="http://grails.org">Grails</a> when the WAR file is built using the <code>grails war</code> command.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Based on the code above, it appears that the DSL is only loaded when the WAR is deployed.  This explains why no matter how many changes I made to the DSL, none of those changes were getting picked up.
Being familiar with <a href="http://logback.qos.ch/">Logback</a>, I knew that if you put a <code>logback.groovy</code> file on the classpath, <a href="http://logback.qos.ch/">Logback</a> would automatically find and use it for configuration instead of the DSL.  To test this theory,
I put a new <code>logback.groovy</code> file in <code>grails-app/conf</code> to ensure it was on the classpath.  I also added the following the <code>grails-app/conf/BootStrap.groovy</code> to verify which configuration <a href="http://logback.qos.ch/">Logback</a> had
selected:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/BootStrap.groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>def init = { servletContext -&gt;
    StatusPrinter.print((LoggerContext) LoggerFactory.getILoggerFactory())		<i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Useful line of code to enable <a href="http://logback.qos.ch/">Logback</a> to print out which (if any) configuration file it loaded.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After another application restart, I noticed that <a href="http://logback.qos.ch/">Logback</a> was still not picking up my configuration.  I did a quick check of <code>target/classes</code> to confirm a suspicion that <a href="http://grails.org">Grails</a> had compiled my <code>logback.groovy</code>
file instead of treating it like a non-source file.  Sure enough, I found <code>logback.class</code> in <code>target\classes</code>.  This meant that I would need to come up with a creative way to get <a href="http://grails.org">Grails</a> to get an
un-compiled version of the file on the classpath.  My first thought was to put some logic in <code>grails-app/conf/BuildConfig.groovy</code> to set the <code>logback.configurationFile</code> system property supported by
<a href="http://logback.qos.ch/">Logback</a> to the un-compiled version of <code>logback.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/BuildConfig.groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>/*
 * If the application is being run locally, set the Logback configuration file
 * system property.  This is necessary as Grails will attempt to compile the .groovy
 * file instead of simply adding it to the classpath "as is".  There is a corresponding
 * event handler in 'scripts/Events.groovy' that takes care of making sure that the
 * Groovy configuration file makes it into the WAR in its un-compiled state.
 */
if(new File("${basedir}/grails-app/conf/logback.groovy").exists()) {
    System.setProperty('logback.configurationFile', "${basedir}/grails-app/conf/logback.groovy")		<i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is a programmatic way to force <a href="http://logback.qos.ch/">Logback</a> to use the <a href="http://groovy.codehaus.org">Groovy</a>-based configuration file.  This could also be set as an JVM argument (<code>-Dlogback.configurationFile=...</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After adding this code and restarting the application, <a href="http://logback.qos.ch/">Logback</a> finally found and loaded by custom configuration file.  This little trick works great when running the application using
the <code>run-app</code> command, but I knew that I would have the same issue when building the WAR file.  To address getting the <code>logback.groovy</code> file in to the built WAR file as an un-compiled
configuration file, I added the following to <code>scripts/Events.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">scripts/Events.groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>eventCreateWarStart = { warName, stagingDir -&gt;
    ant.copy file:"${basedir}/grails-app/conf/logback.groovy", todir: "${stagingDir}/WEB-INF/classes"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <a href="http://grails.org">Grails</a> starts the process of building the WAR file, this script will now copy over the un-compiled <code>logback.groovy</code> file to <code>classes</code> folder in the WAR.  This will guarantee that the
file is on the classpath for <a href="http://logback.qos.ch/">Logback</a> to find at runtime in its un-compiled form.  After making this change, I built the WAR file and extracted it to verify the results.  Everything looked good.</p>
</div>
<div class="paragraph">
<p>In retrospect, I could have easily just ditched the <a href="http://grails.org/plugin/logback">Grails Logback Plugin</a> in favor of directly using the <a href="http://logback.qos.ch/">Logback</a> dependencies, but I still would have encountered the issue with <a href="http://grails.org">Grails</a> compiling the
<code>logback.groovy</code> file.  In addition I also would have lost support for the automatic <code>log</code> property injection in controllers, tag libraries, etc that <a href="http://grails.org">Grails</a> provides via an AST transformation.  In my
spare time, I might attempt to make some modifications to the <a href="http://grails.org/plugin/logback">Grails Logback Plugin</a> to handle using the DSL in non-WAR-deployed scenarios, which would elminate the need for a <code>logback.groovy</code> file.</p>
</div>
</div></p>
                <p><a href="/blog/2014/03/24/grails_logback.html#disqus_thread">Comments</a></p>
                   <a href="/blog/2014/03/18/grails_bean_builder.html"><h1>Parsing the Grails Spring Beans DSL with Groovy</h1></a>
                   <p>18 March 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/grails.html">grails</a>
        
                <a href="/blog/tags/spring.html">spring</a>
        
                <a href="/blog/tags/groovy.html">groovy</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog/2014/03/18/grails_bean_builder.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog/2014/03/18/grails_bean_builder.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog/2014/03/18/grails_bean_builder.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As part of a current project, I recently had the need to determine which of my <a href="http://grails.org">Grails</a> applications made use of certain <a href="http://spring.io">Spring</a> beans in order to prepare for a migration.  While it is possible to
use the normal XML-based configuration in a <a href="http://grails.org">Grails</a> application (which in turn would have made parsing the configuration fairly straight forward), <a href="http://grails.org">Grails</a> applications typically make use of the built-in
<a href="http://grails.org/doc/latest/guide/spring.html#springdslAdditional">Spring beans DSL</a> to declare their <a href="http://spring.io">Spring</a> configuration.  However, because the DSL is represented in <a href="http://groovy.codehaus.org">Groovy</a>, it meant that parsing it
would not be as easy as if it were in XML.  I decided that the best approach would be to use the <code>grails.spring.BeanBuilder</code> outside of a <a href="http://grails.org">Grails</a> application in a <a href="http://groovy.codehaus.org">Groovy</a> script.  I was particularly interested
in finding beans of type <code>org.springframework.remoting.httpinvoker.HttpInvokerProxyFactoryBean</code> class, which have <code>serviceInterface</code> and <code>serviceUrl</code> properties, so I wrote a script that loads and parses the
DSL and then loops over each bean definition for beans that contained those properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>@Grapes([
    @Grab(group='org.grails', module='grails-spring', version='2.3.6'),
    @Grab(group='org.springframework', module='spring-web', version='4.0.2.RELEASE')
])

import grails.spring.BeanBuilder

// The resources.groovy file must have:
//
// beans {
//
// and not
// beans = {
//
// for this script to work!

BeanBuilder beanBuilder = new BeanBuilder()
beanBuilder.setClassLoader(this.class.classLoader)
beanBuilder.loadBeans('file:./grails-app/conf/spring/resources.groovy')

beanBuilder.springConfig.beanConfigs.each {
    if(it.value.definition.propertyValues.getPropertyValue('serviceInterface')) {
        println "${it.key} -&gt; ${it.value.clazz.name}"
        println "\tserviceUrl = ${it.value.definition.propertyValues.getPropertyValue('serviceUrl').value}"
        println "\tserviceInterface = ${it.value.definition.propertyValues.getPropertyValue('serviceInterface').value}"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple of important things to note in the example above:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>grails.spring.BeanBuilder</code> can be used outside of <a href="http://grails.org">Grails</a> applications by including the <code>org.grails:grails-spring</code> module.</p>
</li>
<li>
<p>The <code>resources.groovy</code> file (or any file that contains the proper DSL syntax) must have <code>beans</code> closure be the top level of the DSL and not be a variable (i.e. beans = { &#8230; ) for the script to parse the file correctly.</p>
</li>
<li>
<p>In the example above, I did not provide a full classpath for all of the possible beans in the file.  This means that you cannot create the application context from the builder without getting ClassNotFoundException errors.</p>
</li>
<li>
<p>Command line argument parsing could be added to allow for the script to be run from anywhere and not just the root of the Grails application, as is the case in the example above.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All and all, this script was pretty easy to create and can be used as part of a larger process to identify, convert and/or even re-write the <code>resources.groovy</code> file.  Additionally, this
<a href="http://spring.io/blog/2014/03/03/groovy-bean-configuration-in-spring-framework-4">DSL has now been incorporated directly into the Spring Framework</a>), which means that not only can you now declare <a href="http://spring.io">Spring</a> beans via the <a href="http://groovy.codehaus.org">Groovy</a>
DSL just like in <a href="http://grails.org">Grails</a>, but that you could use the same solution above to inspect that configuration outside of the application if the need should arise.</p>
</div>
</div>
</div></p>
                <p><a href="/blog/2014/03/18/grails_bean_builder.html#disqus_thread">Comments</a></p>

                <hr />

                <p>Older posts are available in the <a href="/blog/archive.html">archive</a>.</p>

            </div>
            <div id="push"></div>
        </div>

        <div id="footer">
              <div class="container">
                <p class="muted credit">&copy; 2014 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.3.0-SNAPSHOT</a> | Comments powered by <a href="http://disqus.com">Disqus</a></p>
              </div>
        </div>

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="https://code.jquery.com/jquery.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="/blog/js/run_prettify.js"></script>
        <script src="/blog/js/github_activity.js"></script>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jdpearlin'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <script type="text/javascript">
              window.___gcfg = {lang: 'en'};

              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
        </script>
        <script type="text/javascript">
            (function(d, s, id) {
                  var js, fjs = d.getElementsByTagName(s)[0];
                  if (d.getElementById(id)) return;
                  js = d.createElement(s); js.id = id;
                  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                  fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        </script>
        <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
        <script type="text/javascript">
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47885115-1', 'jdpgrailsdev.github.io');
          ga('send', 'pageview');
        </script>
    </body>
</html>