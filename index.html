<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>The Flowers Are Still Standing</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="" />
        <meta name="author" content="Jonathan Pearlin" />
        <meta name="keywords" content="" />
        <meta name="generator" content="JBake" />

        <!-- Le styles -->
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
        <link href="/blog/css/asciidoctor.css" rel="stylesheet">
        <link href="/blog/css/base.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
		<link href='/blog/css/octicons.min.css' rel='stylesheet' type='text/css'>

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
              <script src="/blog/js/html5shiv.js"></script>
        <![endif]-->

        <!-- Fav and touch icons -->
        <!--
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png" />
        <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png" />
        -->
        <link rel="shortcut icon" href="/blog/favicon.ico" />
    </head>
    <body>
        <div id="wrap">
            <!-- Fixed navbar -->
            <div class="navbar navbar-default navbar-fixed-top" role="navigation">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/blog/index.html">Jonathan Pearlin's Blog</a>
                    </div>
                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="/blog/about.html">About</a></li>
                            <li><a href="/blog/resume.html">Résumé</a></li>
                            <li><a href="/blog/friends.html">Friends</a></li>
                            <li class="dropdown">
                                <a data-toggle="dropdown" href="#">Tags<b class="caret"></b></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="/blog/tags/gradle.html">Gradle</a></li>
                                    <li><a href="/blog/tags/grails.html">Grails</a></li>
                                    <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                                    <li><a href="/blog/tags/java.html">Java</a></li>
                                    <li><a href="/blog/tags/maven.html">Maven</a></li>
                                    <li><a href="/blog/tags/spring.html">Spring</a></li>
                                    <li><a href="/blog/tags/zookeeper.html">ZooKeeper</a></li>
                                </ul>
                            </li>
                            <li><a href="/blog/feed.xml">Feed</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="https://github.com/jdpgrailsdev" target="_blank"><i class="fa fa-github"></i></a></li>
                            <li><a href="http://www.linkedin.com/pub/jonathan-pearlin/4/946/9a0" style="text-decoration:none;" target="_blank"><i class="fa fa-linkedin-square"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
			<div id="activity" class="pull-left">
	            <div class="panel panel-primary">
	                  <!-- Default panel contents -->
	                  <div class="panel-heading"><a target="_blank" href="http://github.com/jdpgrailsdev?tab=activity"><i class="fa fa-github"></i> My Recent GitHub Activity</a></div>
					  <div class="panel-body">
					      <i class='icon-spinner icon-spin icon-large'></i> Loading...
					  </div>
	                  <!-- List group -->
                      <ul class="list-group">
	                  </ul>
	            </div>
			</div>
            <div class="container">
                <div class="page-header">
                    <h1>The Flowers Are Still Standing</h1>
                </div>

                   <a href="/blog2014/06/10/grails_stracetrace_log.html"><h1>Grails and stacktrace.log</h1></a>
                   <p>10 June 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/grails.html">grails</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog2014/06/10/grails_stracetrace_log.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog2014/06/10/grails_stracetrace_log.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog2014/06/10/grails_stracetrace_log.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Out of the box, the <a href="http://grails.org" target="_blank">Grails</a> framework programmatically configures a file-based logging appender that produces a log file named <code>stacktrace.log</code>.  This log contains any errors generated by the <a href="http://grails.org" target="_blank">Grails</a> application.  One of its problems
is that this appender does not use a rolling file appender and therefore can grow without bound.  Typically, I configure my own applications to use a rolling file appender
which makes the <code>stacktrace.log</code> file superfluous, as all errors are also logged to my custom appender.  You can remove this appender at runtime by adding some magic to your application&#8217;s <code>grails-app/conf/Bootstrap.groovy</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Boostrap.groovy</div>
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>import org.slf4j.LoggerFactory

import ch.qos.logback.classic.LoggerContext
import ch.qos.logback.core.util.StatusPrinter

class BootStrap {

    def init = { servletContext -&gt;
        // Remove the Grails stack trace log appender, as it does not use a rolling appender.
        removeStackTraceLogAppender()
    }

    def destroy = {
    }

    /**
     * Removes the 'stacktraceLog' appender added by Grails.  This appender does NOT use a
     * rolling file appender and can grow to astronomical sizes if left unattended.  Removing
     * this log file does not remove any data, as the errors logged to it also get logged
     * to the console appender.
     */
    private def removeStackTraceLogAppender() {
        def logger = LoggerFactory.getLogger('StackTrace')
        if(logger) {
            def stackTraceAppender = logger.getAppender('stacktraceLog')
            if(stackTraceAppender) {
                if(logger.detachAppender(stackTraceAppender)) {
                    println "Grails 'stacktraceLog' log appender removed from configuration."
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above asks the <a href="http://www.slf4j.org/" target="blank">SLF4J</a> API for the <code>StackTrace</code> logger, which is created programmatically by the <a href="http://grails.org" target="_blank">Grails</a> framework.  From that logger, the <code>stacktraceLog</code> appender
is retrieved and detached, to ensure that any information sent to the <code>StackTrace</code> logger does not get appended to the <code>stacktrace.log</code> file.  This helps to prevent this log file from growing in an unbounded manner.</p>
</div>
</div>
</div></p>
                <p><a href="/blog2014/06/10/grails_stracetrace_log.html#disqus_thread">Comments</a></p>
                   <a href="/blog2014/06/03/spring_boot_jersey_2.html"><h1>Spring Boot, Jersey and Lazy Initialization</h1></a>
                   <p>03 June 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/spring.html">spring</a>
        
                <a href="/blog/tags/jersey.html">jersey</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog2014/06/03/spring_boot_jersey_2.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog2014/06/03/spring_boot_jersey_2.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog2014/06/03/spring_boot_jersey_2.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>It is pretty simple to spin up a micro REST service using <a href="http://projects.spring.io/spring-boot/" target="_blank">Spring Boot</a> and <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a>.  In fact, there are various tutorials out there that show how this can be done with very little code/configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/dsyer/spring-boot-jersey" target="_blank">Spring Boot Jersey module</a></p>
</li>
<li>
<p><a href="http://geowarin.github.io/spring-boot/jersey/2014/01/31/a-simple-spring-boot-and-jersey-application.html" target="_blank">A Simple Spring Boot and Jersey Application</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a> also provides a nice <a href="https://jersey.java.net/documentation/latest/spring.html" target="_blank">Spring support module</a>, which makes it easy to register <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a> resources as Spring components.  The first step
is to create a Spring-based <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a> resource configuration:</p>
</div>
<div class="listingblock">
<div class="title">JerseyConfig.java</div>
<div class="content">
<pre class="prettyprint java language-java"><code>import org.glassfish.jersey.server.ResourceConfig;
import org.glassfish.jersey.server.spring.SpringComponentProvider;
import org.glassfish.jersey.server.spring.scope.RequestContextFilter;
import org.springframework.stereotype.Component;

@Component
public class JerseyConfig extends ResourceConfig {

    public JerseyConfig() {
        register(MyResource.class);
        register(RequestContextFilter.class);
        register(LoggingFilter.class);
        register(SpringComponentProvider.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have the configuration created (and Spring set up to component scan it at startup up), you also need to create a servlet to register the configuration with <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a>:</p>
</div>
<div class="listingblock">
<div class="title">ApplicationConfig.java</div>
<div class="content">
<pre class="prettyprint java language-java"><code>import java.io.IOException;

import org.glassfish.jersey.servlet.ServletContainer;
import org.glassfish.jersey.servlet.ServletProperties;
import org.springframework.boot.context.embedded.ServletRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;

@Configuration
@ComponentScan({"com.test"})
public class ApplicationConfig {

    @Bean
    public ServletRegistrationBean jerseyServlet() {
        final ServletRegistrationBean registration = new ServletRegistrationBean(new ServletContainer(), "/api/*");
        registration.addInitParameter(ServletProperties.JAXRS_APPLICATION_CLASS, JerseyConfig.class.getName());
        return registration;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is pretty simple, but when you start up the application and then make a call to your REST resource, you may notice that <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a> is not initialized until this first call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>2014-05-19 12:08:30.062  INFO 8626 --- [lication.main()] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080/http
2014-05-19 12:08:30.065  INFO 8626 --- [lication.main()] com.test.Application        		      : Started Application in 13.461 seconds (JVM running for 21.588)
2014-05-19 12:10:29.363  INFO 8626 --- [lication.main()] o.g.jersey.server.ApplicationHandler     : Initiating Jersey application, version Jersey: 2.7 2014-03-12 18:11:31...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that the first request to your service incurs the cost of initializing <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a>.  Luckily, there is a simple fix that will ensure that <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a> is initialized on startup.  We can add
a call to the <code>setLoadOnStartup()</code> method of the <code>ServletRegistration</code> instance in our Spring configuration to ensure that <a href="https://jersey.java.net/" target="_blank">Jersey 2.x</a> is initialized upon application start up:</p>
</div>
<div class="listingblock">
<div class="title">ApplicationConfig.java</div>
<div class="content">
<pre class="prettyprint java language-java"><code>import java.io.IOException;

import org.glassfish.jersey.servlet.ServletContainer;
import org.glassfish.jersey.servlet.ServletProperties;
import org.springframework.boot.context.embedded.ServletRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;

@Configuration
@ComponentScan({"com.test"})
public class ApplicationConfig {

    @Bean
    public ServletRegistrationBean jerseyServlet() {
        final ServletRegistrationBean registration = new ServletRegistrationBean(new ServletContainer(), "/api/*");
        registration.addInitParameter(ServletProperties.JAXRS_APPLICATION_CLASS, JerseyConfig.class.getName());
        registration.setLoadOnStartup(1);
        return registration;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the change above, the Jersey application is initialized prior to application start:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>2014-05-19 12:10:29.363  INFO 8626 --- [lication.main()] o.g.jersey.server.ApplicationHandler     : Initiating Jersey application, version Jersey: 2.7 2014-03-12 18:11:31...
2014-05-19 12:10:30.062  INFO 8626 --- [lication.main()] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080/http
2014-05-19 12:10:30.065  INFO 8626 --- [lication.main()] com.test.Application        		      : Started Application in 13.461 seconds (JVM running for 21.588)</code></pre>
</div>
</div>
</div>
</div></p>
                <p><a href="/blog2014/06/03/spring_boot_jersey_2.html#disqus_thread">Comments</a></p>
                   <a href="/blog2014/05/27/grails_maven_jdk_profile.html"><h1>Grails, Maven and JDK-based Profile Activation</h1></a>
                   <p>27 May 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/grails.html">grails</a>
        
                <a href="/blog/tags/maven.html">maven</a>
        
                <a href="/blog/tags/java.html">java</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog2014/05/27/grails_maven_jdk_profile.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog2014/05/27/grails_maven_jdk_profile.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog2014/05/27/grails_maven_jdk_profile.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Recently, I have been spending my time converting <a href="http://grails.org" target="_blank">Grails</a> applications to use <a href="http://maven.apache.org/" target="_blank">Maven</a> POM files for dependency management.  For the last couple releases, <a href="http://grails.org" target="_blank">Grails</a> has included the ability to
rely on a POM file for dependencies, instead of declaring the repositories and dependencies directly in your <code>grails-app/conf/BuildConfig.groovy</code>.  This works exactly as expected&#8201;&#8212;&#8201;that is <a href="http://grails.org" target="_blank">Grails</a>
retrieves the dependency declarations from the POM file and uses them to build/run the application when using the <a href="http://grails.org" target="_blank">Grails</a> CLI.  However, there is a bug in the way <a href="http://grails.org" target="_blank">Grails</a> dynamically validates and
uses the POM file.  I came across this issue when attempting to use the JDK version-based profile activation that I discussed in <a href="http://jonathanpearlin.com/blog/2014/04/03/maven_java8_javadoc.html" target="_blank">a previous post</a>.
When a JDK-activated profile is present in the POM file used by <a href="http://grails.org" target="_blank">Grails</a>, the application will report the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>[ERROR] Failed to determine Java version for profile java8 @ &lt;GAV of the POM file containing the profile&gt;
        at org.apache.maven.model.building.DefaultModelProblemCollector.newModelBuildingException(DefaultModelProblemCollector.java:195)
        at org.apache.maven.model.building.DefaultModelBuilder.build(DefaultModelBuilder.java:416)
        at org.apache.maven.model.building.DefaultModelBuilder.build(DefaultModelBuilder.java:368)
        at org.apache.maven.model.building.DefaultModelBuilder.build(DefaultModelBuilder.java:359)
        at grails.util.BuildSettings.doResolve(BuildSettings.groovy:513)
        at grails.util.BuildSettings.doResolve(BuildSettings.groovy)
        at grails.util.BuildSettings$_getDefaultBuildDependencies_closure17.doCall(BuildSettings.groovy:774)
        at grails.util.BuildSettings$_getDefaultBuildDependencies_closure17.doCall(BuildSettings.groovy)
        at grails.util.BuildSettings.getDefaultBuildDependencies(BuildSettings.groovy:768)
        at grails.util.BuildSettings.getBuildDependencies(BuildSettings.groovy:673)</code></pre>
</div>
</div>
<div class="paragraph">
<p>At first, I was confused.  This same error does not happen if you use the <a href="https://github.com/grails/grails-maven" target="_blank">Grails Maven Plugin</a> to build/run your application&#8201;&#8212;&#8201;it only happens when using the
<a href="http://grails.org" target="_blank">Grails</a> CLI.  I also know that <a href="http://grails.org" target="_blank">Grails</a> &#8656; 2.3.X does not support Java 8, so maybe it was related to that?  After looking at the <a href="http://grails.org" target="_blank">Grails</a> source (and the stacktrace), I found some interesting code in the
<a href="https://github.com/apache/maven/blob/maven-3.1.1/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/JdkVersionProfileActivator.java" target="_blank">JdkVersionProfileActivator</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint java language-java"><code>String version = context.getSystemProperties().get( "java.version" );

if ( version == null || version.length() &lt;= 0 )
{
    problems.add( new ModelProblemCollectorRequest( Severity.ERROR, Version.BASE )
            .setMessage( "Failed to determine Java version for profile " + profile.getId() )
            .setLocation( activation.getLocation( "jdk" ) ) );
    return false;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="http://maven.apache.org/" target="_blank">Maven</a> code checks the <code>java.version</code> system property to determine which version of the JDK is in use to see if it matches up with the requested profile.  After some additional digging in the <a href="http://grails.org" target="_blank">Grails</a> source, I discovered that the
<a href="https://github.com/grails/grails-core/blob/master/grails-aether/src/main/groovy/org/codehaus/groovy/grails/resolve/maven/aether/AetherDependencyManager.groovy" target="_blank">AetherDependencyManager</a> programmatically builds a
<a href="http://maven.apache.org/" target="_blank">Maven</a> <code>DefaultModelBuildingRequest</code>, but does <strong>not</strong> pass the system properties from the JVM to the request.  Therefore, when the <code>JdkVersionProfileActivator</code> attempts to look at the value of the <code>java.version</code> system property, there
are no properties to inspect!  I made a quick change to the <code>AetherDependencyManager</code> class to add the setting of the system properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint groovy language-groovy"><code>final modelRequest = new DefaultModelBuildingRequest()
modelRequest.setPomFile(pomFile)
modelRequest.setSystemProperties(System.properties)
modelRequest.setModelResolver(new GrailsModelResolver(repositorySystem, session, repositories))</code></pre>
</div>
</div>
<div class="paragraph">
<p>After re-testing with the modified code, the <a href="http://grails.org" target="_blank">Grails</a> happily accepted the JDK-based <a href="http://maven.apache.org/" target="_blank">Maven</a> profile without exception.  I have created a <a href="https://github.com/grails/grails-core/pull/492" target="_blank">pull request</a>, which has been merged into the
2.4.x version of <a href="http://grails.org" target="_blank">Grails</a>.  If you need access to this fix earlier, I would suggest creating a branch off of the tagged version of <a href="http://grails.org" target="_blank">Grails</a> that you are currently using and cherry-picking the commit that contains the change.  You can then build
the <code>grails-aether</code> JAR and drop it into the <code>dist</code> folder of your <a href="http://grails.org" target="_blank">Grails</a> installation to consume the change.</p>
</div>
</div>
</div></p>
                <p><a href="/blog2014/05/27/grails_maven_jdk_profile.html#disqus_thread">Comments</a></p>
                   <a href="/blog2014/05/20/grails_maven_coverage.html"><h1>Grails, Maven, Cobertura and Java 7</h1></a>
                   <p>20 May 2014</p>
                <p><em>Tags: </em>
                <a href="/blog/tags/grails.html">grails</a>
        
                <a href="/blog/tags/maven.html">maven</a>
        
                <a href="/blog/tags/java.html">java</a>
        </p>

                <div class="g-plusone" data-size="medium" data-href="http://jdpgrailsdev.github.io/blog2014/05/20/grails_maven_coverage.html"></div>
                <script type="IN/Share" data-url="http://jdpgrailsdev.github.io/blog2014/05/20/grails_maven_coverage.html" data-counter="right"></script>
                <div class="fb-like" data-href="http://jdpgrailsdev.github.io/blog2014/05/20/grails_maven_coverage.html" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>

                   <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When working on upgrading a few <a href="http://grails.org" target="_blank">Grails</a> plugins to 2.3.x and converting them to be built using the <a href="http://grails.org/doc/latest/guide/commandLine.html#4.5%20Ant%20and%20Maven" target="_blank">Grails Maven Plugin</a>, I ran into a weird issue when
executing unit tests with the <a href="https://github.com/beckje01/grails-code-coverage" target="_blank">Grails Code Coverage Plugin</a> installed and enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint"><code>Error |
Compilation error compiling [unit] tests: Expecting a stackmap frame at branch target 97
Exception Details:
  Location:
    com/test/compiler/injection/DeletableASTTransformation.visit([Lorg/codehaus/groovy/ast/ASTNode;Lorg/codehaus/groovy/control/SourceUnit;)V @62: ifeq
  Reason:
    Expected stackmap frame at this location.
  Bytecode:
    0000000: 033e 11ff ff36 0412 1e11 0023 b800 242b
    0000010: 0432 c000 343a 0512 1e11 0024 b800 242b
    0000020: 0332 c000 363a 0612 1e11 0025 b800 242b
    0000030: 0332 c100 3611 0025 3e11 0000 3604 9900
    0000040: 2312 1e1d 1504 04b8 003a 11ff ff36 042b
    0000050: 0432 c100 3411 0025 3e11 0001 3604 9a00
    0000060: 481d 1100 25a0 001c 1504 1100 01a0 0014
    0000070: 121e 1d15 0404 b800 3a11 ffff 3604 a700
    0000080: 1615 049b 0011 121e 1d15 0403 b800 3a11
    0000090: ffff 3604 121e 1100 26b8 0024 bb00 3c59
    00000a0: 123e b700 41bf 1504 9b00 1112 1e1d 1504
    00000b0: 03b8 003a 11ff ff36 0412 1e11 0029 b800
    00000c0: 24b2 0043 1906 b600 47b6 004d 1100 293e
    00000d0: 1100 0036 049a 0012 121e 1d15 0404 b800
    00000e0: 3a11 ffff 3604 b115 049b 0011 121e 1d15
    00000f0: 0403 b800 3a11 ffff 3604 121e 1100 2bb8
    0000100: 0024 1905 c100 4f11 002b 3e11 0000 3604
    0000110: 9900 ea1d 1100 2ba0 0019 1504 1100 00a0
    0000120: 0011 121e 1d15 0404 b800 3a11 ffff 3604
    0000130: 121e 1100 2cb8 0024 1905 c000 4f3a 0712
    0000140: 1e11 002d b800 2419 07b6 0052 1254 b800
    0000150: 5a11 002d 3e11 0000 3604 9900 331d 1100
    0000160: 2da0 0019 1504 1100 00a0 0011 121e 1d15
    0000170: 0404 b800 3a11 ffff 3604 121e 1100 2eb8
    0000180: 0024 2a19 0719 06b7 005e a700 6515 049b
    0000190: 0011 121e 1d15 0403 b800 3a11 ffff 3604
    00001a0: 121e 1100 30b8 0024 bb00 3c59 bb00 6059
    00001b0: b700 6112 63b6 0067 1905 b600 6ab6 006d
    00001c0: 126f b600 67b2 0071 b600 6712 73b6 0067
    00001d0: 1907 121e 1100 31b8 0024 b600 52b6 0077
    00001e0: b600 6712 79b6 0067 b600 7cb7 0041 bf12
    00001f0: 1e11 0033 b800 24a7 005d 1504 9b00 1112
    0000200: 1e1d 1504 03b8 003a 11ff ff36 0412 1e11
    0000210: 0034 b800 24bb 003c 59bb 0060 59b7 0061
    0000220: 1263 b600 6719 05b6 006a b600 6d12 6fb6
    0000230: 0067 b200 71b6 0067 127e b600 6719 0512
    0000240: 1e11 0035 b800 24b6 0082 b600 6db6 007c
    0000250: b700 41bf 121e 1100 37b8 0024 b1
  Stackmap Table:
    append_frame(@156,Object[#52],Object[#54])
    same_frame(@193)
    same_frame_extended(@258)
    append_frame(@424,Object[#79])
    chop_frame(@503,1)
    same_frame(@533)
    same_frame_extended(@604)

    at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)
    at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)
    at _GrailsTest$_run_closure1.doCall(_GrailsTest.groovy:102)
    at org.codehaus.gant.GantMetaClass.invokeMethod(GantMetaClass.java:133)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16_closure18.doCall(GantBinding.groovy:185)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16_closure18.doCall(GantBinding.groovy)
    at org.codehaus.gant.GantBinding.withTargetEvent(GantBinding.groovy:90)
    at org.codehaus.gant.GantBinding.this$4$withTargetEvent(GantBinding.groovy)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16.doCall(GantBinding.groovy:185)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16.doCall(GantBinding.groovy)
    at org.codehaus.gant.GantMetaClass.invokeMethod(GantMetaClass.java:133)
    at TestApp$_run_closure1.doCall(TestApp.groovy:32)
    at org.codehaus.gant.GantMetaClass.invokeMethod(GantMetaClass.java:133)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16_closure18.doCall(GantBinding.groovy:185)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16_closure18.doCall(GantBinding.groovy)
    at org.codehaus.gant.GantBinding.withTargetEvent(GantBinding.groovy:90)
    at org.codehaus.gant.GantBinding.this$4$withTargetEvent(GantBinding.groovy)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16.doCall(GantBinding.groovy:185)
    at org.codehaus.gant.GantBinding$_initializeGantBinding_closure5_closure16.doCall(GantBinding.groovy)
    at gant.Gant$_dispatch_closure5.doCall(Gant.groovy:381)
    at gant.Gant$_dispatch_closure7.doCall(Gant.groovy:415)
    at gant.Gant$_dispatch_closure7.doCall(Gant.groovy)
    at gant.Gant.withBuildListeners(Gant.groovy:427)
    at gant.Gant.this$2$withBuildListeners(Gant.groovy)
    at gant.Gant$this$2$withBuildListeners.callCurrent(Unknown Source)
    at gant.Gant.dispatch(Gant.groovy:415)
    at gant.Gant.this$2$dispatch(Gant.groovy)
    at gant.Gant.invokeMethod(Gant.groovy)
    at gant.Gant.executeTargets(Gant.groovy:591)
    at gant.Gant.executeTargets(Gant.groovy:590)
    at org.grails.launcher.GrailsLauncher.launch(GrailsLauncher.java:144)
    at org.grails.maven.plugin.tools.ForkedGrailsRuntime.main(ForkedGrailsRuntime.java:168)

[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 59.895 s
[INFO] Finished at: 2014-05-05T07:49:39-05:00
[INFO] Final Memory: 17M/75M</code></pre>
</div>
</div>
<div class="paragraph">
<p>I should point out that the same exact unit tests (without any modifications) passed, even with instrumentation for the code coverage calculation, prior to upgrading from <a href="http://grails.org" target="_blank">Grails</a> 2.0.x to 2.3.x.  Could this be one of those subtle
<a href="http://groovy.codehaus.org" target="_blank">Groovy</a> low-level changes that causes code that once ran fine to all of a sudden be incorrect?  After doing some searching on the internets, I discovered that Java 7 introduced much stricter verification than previous Java versions.
As I was using Java 7 with <a href="http://grails.org" target="_blank">Grails</a> 2.0.x, my guess is that something in the underlying <a href="http://groovy.codehaus.org" target="_blank">Groovy</a> code in the updated version of <a href="http://grails.org" target="_blank">Grails</a> does not contain a valid stack map (in Java 7&#8217;s eyes) for the method(s) in question.  Luckily, the verifier can be
disabled until the issue is resolved by the framework.  The <code>-Xverify:none</code> JVM argument can be used to tell the Java 7 verifier not to do its thing.  In order to tell the <a href="http://grails.org/doc/latest/guide/commandLine.html#4.5%20Ant%20and%20Maven" target="_blank">Grails Maven Plugin</a>
to pass this JVM argument to the forked <a href="http://grails.org" target="_blank">Grails</a> process, I had to make the following tweak to my Maven POM file:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="prettyprint xml language-xml"><code>    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.grails&lt;/groupId&gt;
                &lt;artifactId&gt;grails-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${grails.version}&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;fork&gt;true&lt;/fork&gt;
                    &lt;forkedVmArgs&gt;
                        &lt;!-- Disable verifier to avoid issues with Java 7 verifier and code
                            instrumentation --&gt;
                        &lt;forkedVmArg&gt;-Xverify:none&lt;/forkedVmArg&gt;
                    &lt;/forkedVmArgs&gt;
                    &lt;nonInteractive&gt;true&lt;/nonInteractive&gt;
                    &lt;showStacktrace&gt;true&lt;/showStacktrace&gt;
                    &lt;pluginsDir&gt;${project.build.directory}/plugins&lt;/pluginsDir&gt;
                &lt;/configuration&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After add the argument and re-running the tests, everything passed as expected.  I am still not sure if the problem lies with <a href="http://grails.org" target="_blank">Grails</a>, <a href="http://groovy.codehaus.org" target="_blank">Groovy</a> or the instrumentation provided by the <a href="https://github.com/beckje01/grails-code-coverage" target="_blank">Grails Code Coverage Plugin</a> or
some combination of all of those.  I will continue to keep an eye out for updates that appear to affect this issue in the hopes that the verifier can be re-enabled in the future.</p>
</div>
</div>
</div></p>
                <p><a href="/blog2014/05/20/grails_maven_coverage.html#disqus_thread">Comments</a></p>

                <hr />

                <p>Older posts are available in the <a href="/blog/archive.html">archive</a>.</p>

            </div>
            <div id="push"></div>
        </div>

        <div id="footer">
              <div class="container">
                <p class="muted credit">&copy; 2014 | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.3.0</a> | Comments powered by <a href="http://disqus.com">Disqus</a></p>
              </div>
        </div>

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="https://code.jquery.com/jquery.js" type="text/javascript"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="/blog/js/run_prettify.js" type="text/javascript"></script>
        <script src="/blog/js/github_activity.js" type="text/javascript"></script>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jdpearlin'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <script type="text/javascript">
              window.___gcfg = {lang: 'en'};

              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
        </script>
        <script type="text/javascript">
            (function(d, s, id) {
                  var js, fjs = d.getElementsByTagName(s)[0];
                  if (d.getElementById(id)) return;
                  js = d.createElement(s); js.id = id;
                  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                  fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        </script>
        <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
        <script type="text/javascript">
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-47885115-1', 'jdpgrailsdev.github.io');
          ga('send', 'pageview');
        </script>
    </body>
</html>